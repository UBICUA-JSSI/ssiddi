openapi: 3.0.0
info:
  title: SSIDDI Data Model
  description: SSIDDI Data Model
  version: 1.0.0
  
servers:
  - url: http://82.223.203.200:3001/
    description: SSIDDI Test Server
    
tags:
  - name: SSIDDI Data Model
    description: SSIDDI Data Model

paths:
  /metadata:
    get:
      summary: Get the model version
      responses:
        '200':
          description: The model version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/metadata'
            application/xml:
              schema:
                $ref: '#/components/schemas/metadata'                
  /organisations:
    get:
      summary: Get SSIDDI organisations by filters
      parameters:
      - in: query
        name: filter
        description: a wildcard parameter
        schema:
          type: string          
      responses:
        '200':
          description: all organisations filtered by wildcard parameter 
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/organisation' 
            application/xml:
              schema:
                type: array
                items:              
                  $ref: '#/components/schemas/organisation'                    
  /organisation/{uuid}:
    get:
      summary: Get an organisation by uuid
      parameters:
      - in: path
        name: uuid
        description: organisation uuid
        required: true
        schema:
          type: string
      - in: query
        name: lang
        description: language parameter (en as default)
        schema:
          type: string          
      responses:
        '200':
          description: a single organisation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/organisation'
            application/xml:
              schema:
                $ref: '#/components/schemas/organisation'                 
  /service/{uuid}:
    get:
      summary: Get a service by uuid
      parameters:
      - in: path
        name: uuid
        description: Service Id
        required: true
        schema:
          type: string
      - in: query
        name: lang
        description: Language parameter (en as default)
        schema:
          type: string          
      responses:
        '200':
          description: A single service
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/service'
            application/xml:
              schema:
                $ref: '#/components/schemas/service'                
  /interface/{uuid}:
    get:
      summary: Get a service interface by uuid
      parameters:
      - in: path
        name: uuid
        description: Service Id
        required: true
        schema:
          type: string         
      responses:
        '200':
          description: A service interface
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/interface'
            application/xml:
              schema:
                $ref: '#/components/schemas/interface'                  
                
components:
  schemas:
    model:
      type: object
      required:
      - metadata
      - organisations      
      properties:
        metadata:
          $ref: '#/components/schemas/metadata'
        organisations:
          type: array
          items:
            $ref: '#/components/schemas/organisation'
    metadata:      
      type: object
      properties:
        name:
          type: string
          example: ssiddi      
        version:
          type: string
          example: v1.0
    organisation:
      type: object    
      required:
      - uuid
      - name
      - services
      properties:
        uuid:
          type: string
          format: uuid
          example: 12345678-abcd-1234-efgh-ab12345678cd
        name:
          type: string
          example: Example University
        categoryBag:
          $ref: '#/components/schemas/categoryBag'         
        services:
          type: array
          items:
            $ref: '#/components/schemas/service'
    categoryBag:
      type: array
      items:
        $ref: '#/components/schemas/reference'
    reference:
      type: object
      required:
        - key
        - value
      properties:
        key:
          type: string
          example: http://dd.eionet.europa.eu/vocabulary/eurostat/nace_r2/
          xml:
            attribute: true
        name:
          type: string
          example: Higher education     
          xml:
            attribute: true
        value:
          type: string
          example: P854    
          xml:
            attribute: true
    service:
      type: object    
      required:
      - uuid
      - description
      - accreditation
      properties:
        uuid:
          type: string
          format: uuid          
          example: 12345678-abcd-1234-efgh-ab12345678ef
        status:
          type: string
          example: available
        description:
          $ref: '#/components/schemas/dictionary'
        policy:
          $ref: '#/components/schemas/policy'
        accreditation:
          $ref: '#/components/schemas/accreditation'
        subsribers:
          $ref: '#/components/schemas/subscribers'
        interfaces:
          type: array
          items:
            $ref: '#/components/schemas/interface'           
        signature:
          $ref: '#/components/schemas/signature'
    policy:
      type: object
      required:
        - name
        - text
        - decisionPoint
      properties:
        name:
          type: string
          example: Credential policy
        text:
          $ref: '#/components/schemas/dictionary'
        decisionPoint:
          type: string
          example: https://example-university.org
    subscribers:
      type: array
      items:
        $ref: '#/components/schemas/reference'        
    dictionary:
      type: object
      additionalProperties:
        type: string
      example:
        en: Hello
        es: Hola
    accreditation:
      type: object
      required:
      - accreditor
      properties:
        accreditor:
          type: string
          example: "did:sov:12345678abcdefg"
        createdAt:
          type: string
          format: date-time
          example: 2021-07-21T18:05:02Z
        expirationDate:
          type: string
          format: date-time
          example: 2022-07-21T18:05:02Z
    signature:
      type: object
      properties:
        created:
          type: string
          format: date-time
          example: 2021-06-21T18:05:02Z
        text:
          type: string
          example: abc...123=
        type:
          type: string
          example: EidasSeal2021
        verificationMethod:
          type: string
          example: did:sov:234567890abcdefg
    interface:
      type: object
      properties:
        uuid:
          type: string
          format: uuid
          example: 12345678-abcd-1234-efgh-ab12345678gh
        did:
          type: string
          example: "did:sov:12345678abcdefg"          
          
